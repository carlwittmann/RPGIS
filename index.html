<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mapbox and p5.js Template</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js'></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
  <style>
    #map {
        height: 600px;
        width: 100%;
    }
    canvas#p5-canvas {
        position: absolute;
        left: 0;
        top: 0;
        z-index: 1;
        width: 100%;
        height: 100%;
}
    .hidden {
    display: none;
  }

  </style>
</head>
<body>

<button id="toggle-hexagons">Toggle Hexagons</button>

<div id='map'></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYWR2ZXJzYXJpYWwtZ2VvZ3JhcGh5IiwiYSI6ImNsZjBvN3FqbjAwZDkzcmw0MGsxNDJ3MDIifQ.aVzxEUcFBUiojBtwfqYe6w';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/adversarial-geography/clfrqzhep000301mur6p5ps3l',
      center: [-122.4194, 37.7749],
      zoom: 12
    });

    var p5canvas = document.getElementById('p5-canvas');
    var toggleButton = document.getElementById('toggle-hexagons');
    toggleButton.addEventListener('click', function() {
    document.getElementById('p5-canvas').classList.toggle('hidden');
    });

    var sketch = function(p) {
                var gridWidth, gridHeight, hexagonSize;
      
    p.setup = function() {
                var mapContainer = document.getElementById('map');
                var rect = mapContainer.getBoundingClientRect();
                var w = rect.width;
                var h = rect.height;

        p.createCanvas(w, h).id('p5-canvas');

        gridWidth = w;
        gridHeight = h;
    hexagonSize = w/10;
    };

      function drawHexagon(cX, cY, r) {
        p.beginShape();
        for(let a = 0; a < p.TAU; a += p.TAU/6) {
          p.vertex(cX + r * p.cos(a), cY + r * p.sin(a));
        }
        p.endShape(p.CLOSE);
    }

      function makeGrid() {
        var count = 0;
        for(var y = 0; y < gridHeight; y += hexagonSize/2.3) {
          for(var x = 0; x < gridWidth; x += hexagonSize*1.5) {
            drawHexagon(x + hexagonSize*(count%2==0)*0.75, y, hexagonSize/2);
            }
          count ++;
        }
    }

      p.draw = function() {
        p.background(0, 0, 0, 0);
        p.stroke(255);
        p.noFill();

        makeGrid();

        p.noLoop();
    };
};

    var p5 = new p5(sketch, 'map').id('p5canvas');
  </script>
</body>
</html>
