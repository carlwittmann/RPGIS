<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RPGIS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
  <link href='https://watergis.github.io/mapbox-gl-export/mapbox-gl-export.css' rel='stylesheet' />
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
  <script src="https://watergis.github.io/mapbox-gl-export/mapbox-gl-export.js"></script>
  <style>
   
   body {
      background-image: url('https://www.myfreetextures.com/wp-content/uploads/2013/07/old-brown-vintage-parchment-paper-texture.jpg');
      background-size: cover;
    }
   
   #map {
        height: 800px;
        width: 99%;
        border: 4px solid #333;
        border-radius: 4px;
        box-shadow: 0 0 10px #666
    }

    #p5-canvas {
        position: absolute;
        left: 0;
        top: 0;
        z-index: 1;
        width: 100%;
        height: 100%;
        transition: transform 0.5s ease-in-out;
        pointer-events: none}

        #save-as-pdf {
  position: absolute;
  top: 0;
  right: 0;
  padding: 10px;
}

#map.mirrored {
  transform: scaleX(-1);
}


    .hidden {
    display: none;}
  </style>
</head>
<body>

    <button id="toggle-mirror">Mirror Map</button>

    <button id="toggle-hexagons">Hex Grid On/Off</button>
    
    <label for="hexagon-size-slider">Hex Size:</label>
    <input type="range" min="20" max="150" value="50" class="slider" id="hexagon-size-slider">

    


    <div id="save-as-pdf">Save as PDF</div>
  
    <div id='map'></div>
    
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWR2ZXJzYXJpYWwtZ2VvZ3JhcGh5IiwiYSI6ImNsZjBvN3FqbjAwZDkzcmw0MGsxNDJ3MDIifQ.aVzxEUcFBUiojBtwfqYe6w';
        var map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/adversarial-geography/clfrqzhep000301mur6p5ps3l',
          center: [-122.4194, 37.7749],
          zoom: 3,
          minZoom: 3
        });

        map.addControl(new mapboxgl.NavigationControl());

        var toggleMirrorButton = document.getElementById('toggle-mirror');
        toggleMirrorButton.addEventListener('click', function() {
        document.getElementById('map').classList.toggle('mirrored');
        });

        var p5canvas = document.getElementById('p5-canvas');
        var toggleButton = document.getElementById('toggle-hexagons');
        toggleButton.addEventListener('click', function() {
        document.getElementById('p5-canvas').classList.toggle('hidden');
        });

        
    
        var sketch = function(p) {
          var gridWidth, gridHeight, hexagonSize;
    
          p.setup = function() {
            var mapContainer = document.getElementById('map');
            var rect = mapContainer.getBoundingClientRect();
            var w = rect.width;
            var h = rect.height;
    
            p.createCanvas(w, h).id('p5-canvas');
    
            gridWidth = w;
            gridHeight = h;
            hexagonSize = w/10;
          };
    
          function drawHexagon(cX, cY, r) {
            p.beginShape();
            for(let a = 0; a < p.TAU; a += p.TAU/6) {
              p.vertex(cX + r * p.cos(a), cY + r * p.sin(a));
            }
            p.endShape(p.CLOSE);
          }
    
          function makeGrid() {
            var count = 0;
            for(var y = 0; y < gridHeight; y += hexagonSize/2.3) {
              for(var x = 0; x < gridWidth; x += hexagonSize*1.5) {
                drawHexagon(x + hexagonSize*(count%2==0)*0.75, y, hexagonSize/2);
              }
              count ++;
            }
          }
    
          p.draw = function() {
            p.background(0, 0, 0, 0);
            p.stroke(80, 80, 80, 50);
            p.noFill();
    
            makeGrid();
    
            p.noLoop();
          };
    
          document.getElementById('hexagon-size-slider').addEventListener('input', function() {
            hexagonSize = this.value;
            p.clear();
            p.redraw();
          });
          
          map.addControl(new MapboxExportControl({
            PageSize: Size.A3,
            PageOrientation: PageOrientation.Portrait,
            Format: Format.PNG,
            DPI: DPI[96],
            Crosshair: true,
            PrintableArea: true,
            }), 'top-right');

    };
    
        var p5 = new p5(sketch, 'map').id('p5canvas');
      </script>
    </body>
    
</html>
